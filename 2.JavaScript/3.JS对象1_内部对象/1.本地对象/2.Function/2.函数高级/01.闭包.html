<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>闭包</title>
    <script>
        /*  --闭包--
                1.闭包的定义:闭包就是可以访问外部函数（作用域）中变量的内部函数.
                    当一个嵌套的内部(子)函数引用了嵌套的外部(父)函数的变量(函数)时, 就产生了闭包.
                2.闭包的作用:闭包就是用来保存一些数据.
                3.闭包的特点:
                    编写闭包的三个要件：
                        1.函数的嵌套
                        2.要在内部函数中引用外部函数中的变量
                        3.将内部函数作为返回值返回
                4.闭包的生命周期:
                    闭包是什么时候产生的？
                        - 当调用外部函数时，闭包就已经创建了
                        - 外部函数每调用一次就会产生一个闭包，
                            闭包和闭包之间是相互独立的
                    闭包是什么消失的？
                        - 直到内部函数被GC（垃圾回收）后才消失
                5.闭包的缺点:
                    函数执行完后, 函数内的局部变量没有释放, 占用内存时间会变长
                    容易造成内存泄露
                6.闭包的缺点解决方法:
                    能不用闭包就不用
                    及时释放
        */
        function outer1() {
            var a = 1890;
            function inner1() {
                a++;
                console.log(a);
            }
            console.log("haha" + a); //haha1890
            return inner1;
        }
        var fn = outer1(); //fn接受的是outer的返回值inner
        fn(); //1891  //相当于inner()
        fn = null //闭包死亡(包含闭包的函数对象成为垃圾对象)


        var fun = (function () {
            var times = 0;
            return function () {
                times++;
                console.log(times);
            };
        })();
        fun(); //1
        fun(); //2
        fun(); //3


        function outer2() {
            var n = 0;

            function inner() {
                n++;
                console.log('inner ->',n);
            }

            function inner2() {
                n++;
                console.log('inner2 ->',n)
            }

            // 将内部函数存储到一个对象中返回
            return {inner:inner,inner2:inner2};
        }

        var obj1 = outer2(); //外部函数每调用一次就会产生一个闭包，
        obj1.inner(); //  inner  -> 1
        obj1.inner2();//  inner2 -> 2
        var obj2 = outer2(); //外部函数每调用一次就会产生一个闭包，
        obj2.inner(); //  inner  -> 1
        obj2.inner2();//  inner2 -> 2
    </script>
</head>
<body>

</body>
</html>